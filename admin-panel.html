<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - CertGen Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Componente de navegaci√≥n global -->
    <script src="js/components/navbar.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .status-loading { 
            background: #f59e0b; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .terminal {
            background: #1e293b;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-600 to-slate-800">
    <div class="container mx-auto pt-6">
        <!-- Header -->
        <div class="bg-slate-800 text-white p-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-cogs mr-3"></i>Panel de Administraci√≥n
                    </h1>
                    <p class="text-slate-300">CertGen Pro - Herramientas de Desarrollo y Monitoreo</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-300">Estado del Sistema</div>
                    <div id="systemStatus" class="text-lg font-semibold">
                        <span class="status-indicator status-loading"></span>Verificando...
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white border-b">
            <nav class="flex space-x-8 px-6">
                <button onclick="showSection('servers')" id="serversTab" class="tab-button py-4 px-2 border-b-2 font-medium text-sm border-blue-500 text-blue-600">
                    <i class="fas fa-server mr-2"></i>Servidores
                </button>
                <button onclick="showSection('database')" id="databaseTab" class="tab-button py-4 px-2 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700">
                    <i class="fas fa-database mr-2"></i>Base de Datos
                </button>
                <button onclick="showSection('api')" id="apiTab" class="tab-button py-4 px-2 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700">
                    <i class="fas fa-code mr-2"></i>API & Rutas
                </button>
                <button onclick="showSection('monitoring')" id="monitoringTab" class="tab-button py-4 px-2 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chart-line mr-2"></i>Monitoreo
                </button>
                <button onclick="showSection('tools')" id="toolsTab" class="tab-button py-4 px-2 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700">
                    <i class="fas fa-tools mr-2"></i>Herramientas
                </button>
            </nav>
        </div>

        <!-- Servers Section -->
        <div id="serversSection" class="section p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- PHP Server Control -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-server text-blue-500 text-2xl mr-3"></i>
                        <h3 class="text-lg font-semibold">Servidor PHP</h3>
                        <span id="phpServerStatus" class="status-indicator status-loading ml-auto"></span>
                    </div>
                    <div class="space-y-3">
                        <div class="text-sm text-gray-600">
                            <strong>Puerto:</strong> <span id="phpPort">8085</span><br>
                            <strong>Documento Root:</strong> <span id="phpRoot">.</span><br>
                            <strong>Router:</strong> <span id="phpRouter">router.php</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="startPHPServer()" class="btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                                <i class="fas fa-play mr-1"></i>Iniciar
                            </button>
                            <button onclick="stopPHPServer()" class="btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm">
                                <i class="fas fa-stop mr-1"></i>Detener
                            </button>
                            <button onclick="restartPHPServer()" class="btn bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded text-sm">
                                <i class="fas fa-redo mr-1"></i>Reiniciar
                            </button>
                        </div>
                        <div class="mt-3 text-xs text-gray-500 border-t pt-2">
                            <div class="flex space-x-4">
                                <div class="flex items-center">
                                    <span class="status-indicator status-online mr-1"></span>
                                    <span>Online</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="status-indicator status-loading mr-1"></span>
                                    <span>Verificando...</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="status-indicator status-offline mr-1"></span>
                                    <span>Offline</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Health -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-heartbeat text-red-500 text-2xl mr-3"></i>
                        <h3 class="text-lg font-semibold">API Health</h3>
                        <span id="apiStatus" class="status-indicator status-loading ml-auto"></span>
                    </div>
                    <div class="space-y-2">
                        <div class="text-sm">
                            <span class="font-medium">URL:</span> <span id="apiUrl">http://localhost:8085/api</span>
                        </div>
                        <div class="text-sm">
                            <span class="font-medium">√öltima respuesta:</span> <span id="apiLastResponse">-</span>
                        </div>
                        <div class="text-sm">
                            <span class="font-medium">Tiempo respuesta:</span> <span id="apiResponseTime">-</span>
                        </div>
                        <button onclick="checkAPIHealth()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm mt-2">
                            <i class="fas fa-stethoscope mr-1"></i>Verificar Salud
                        </button>
                    </div>
                </div>

                <!-- Server Logs -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6 md:col-span-2 lg:col-span-1">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-file-alt text-gray-500 text-2xl mr-3"></i>
                            <h3 class="text-lg font-semibold">Logs del Servidor</h3>
                        </div>
                        <button onclick="clearServerLogs()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div id="serverLogs" class="terminal p-3 h-40 overflow-y-auto">
                        <div class="text-green-400">[INFO] Panel de administraci√≥n inicializado</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Database Section -->
        <div id="databaseSection" class="section p-6 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Database Structure -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold flex items-center">
                            <i class="fas fa-table text-blue-500 mr-3"></i>Estructura de Tablas
                        </h3>
                        <button onclick="loadDatabaseStructure()" class="text-blue-500 hover:text-blue-700">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <!-- Contenedor para la estructura completa de la base de datos -->
                    <div id="database-structure" class="mb-4">
                        <p class="text-gray-500 text-center">Haz clic en el bot√≥n actualizar para cargar la estructura</p>
                    </div>
                    
                    <div class="space-y-2 border-t pt-4">
                        <h4 class="text-sm font-semibold text-gray-700">Explorar tabla individual:</h4>
                        <select id="tableSelector" onchange="loadTableStructure(this.value)" class="w-full p-2 border rounded">
                            <option value="">Seleccionar tabla...</option>
                        </select>
                        <div id="tableStructure" class="table-container border rounded p-4 bg-gray-50">
                            <p class="text-gray-500 text-center">Selecciona una tabla para ver su estructura</p>
                        </div>
                    </div>
                </div>

                <!-- Database Data -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold flex items-center">
                            <i class="fas fa-eye text-green-500 mr-3"></i>Consulta de Datos
                        </h3>
                        <div class="flex space-x-2">
                            <select id="queryTable" class="p-2 border rounded text-sm">
                                <option value="">Tabla...</option>
                                <option value="clientes">clientes</option>
                                <option value="instalaciones">instalaciones</option>
                                <option value="tecnicos">tecnicos</option>
                                <option value="certificados">certificados</option>
                                <option value="empresa">empresa</option>
                            </select>
                            <button onclick="queryTableData()" class="btn bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div id="tableData" class="table-container border rounded p-4 bg-gray-50">
                        <p class="text-gray-500 text-center">Selecciona una tabla y haz clic en buscar</p>
                    </div>
                </div>

                <!-- Database Stats -->
                <div class="bg-white rounded-lg shadow-lg p-6 lg:col-span-2">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-chart-bar text-purple-500 mr-3"></i>Estad√≠sticas de Base de Datos
                    </h3>
                    <div id="dbStats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded">
                            <div class="text-2xl font-bold text-blue-600" id="clientesCount">-</div>
                            <div class="text-sm text-gray-600">Clientes</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded">
                            <div class="text-2xl font-bold text-green-600" id="instalacionesCount">-</div>
                            <div class="text-sm text-gray-600">Instalaciones</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded">
                            <div class="text-2xl font-bold text-yellow-600" id="tecnicosCount">-</div>
                            <div class="text-sm text-gray-600">T√©cnicos</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded">
                            <div class="text-2xl font-bold text-purple-600" id="certificadosCount">-</div>
                            <div class="text-sm text-gray-600">Certificados</div>
                        </div>
                    </div>
                    <button onclick="loadDatabaseStats()" class="btn bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded mt-4">
                        <i class="fas fa-sync-alt mr-2"></i>Actualizar Estad√≠sticas
                    </button>
                </div>
            </div>
        </div>

        <!-- API & Routes Section -->
        <div id="apiSection" class="section p-6 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- API Routes -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-route text-indigo-500 mr-3"></i>Rutas API Disponibles
                    </h3>
                    <div id="apiRoutes" class="space-y-2">
                        <div class="loading">Cargando rutas...</div>
                    </div>
                    <button onclick="loadAPIRoutes()" class="btn bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded mt-4">
                        <i class="fas fa-sync-alt mr-2"></i>Actualizar Rutas
                    </button>
                </div>

                <!-- API Testing -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-vial text-pink-500 mr-3"></i>Pruebas de API
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">M√©todo</label>
                            <select id="apiMethod" class="w-full p-2 border rounded">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Endpoint</label>
                            <input type="text" id="apiEndpoint" placeholder="/api/clientes" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Datos JSON (opcional)</label>
                            <textarea id="apiData" placeholder='{"nombre": "test"}' class="w-full p-2 border rounded h-20"></textarea>
                        </div>
                        <button onclick="testAPIEndpoint()" class="btn bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-paper-plane mr-2"></i>Enviar Prueba
                        </button>
                    </div>
                    <div id="apiTestResult" class="mt-4 p-3 bg-gray-50 rounded terminal text-sm hidden"></div>
                </div>

                <!-- Router Configuration -->
                <div class="bg-white rounded-lg shadow-lg p-6 lg:col-span-2">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-cog text-orange-500 mr-3"></i>Configuraci√≥n del Router
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Puerto del Servidor</label>
                            <input type="number" id="serverPort" value="8085" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Documento Root</label>
                            <input type="text" id="documentRoot" value="." class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Archivo Router</label>
                            <input type="text" id="routerFile" value="router.php" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API Base Path</label>
                            <input type="text" id="apiBasePath" value="/api" class="w-full p-2 border rounded">
                        </div>
                    </div>
                    <div class="flex space-x-2 mt-4">
                        <button onclick="updateRouterConfig()" class="btn bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                            <i class="fas fa-save mr-2"></i>Guardar Configuraci√≥n
                        </button>
                        <button onclick="viewRouterFile()" class="btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            <i class="fas fa-eye mr-2"></i>Ver Router Actual
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Database Section -->
        <div id="databaseSection" class="section p-6 hidden">
            <div class="grid grid-cols-1 gap-6">
                <!-- SQL Query Console -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-terminal text-green-500 mr-3"></i>Consola SQL
                    </h3>
                    <div class="space-y-3">
                        <textarea id="sqlQuery" placeholder="SELECT * FROM clientes LIMIT 10;" class="w-full p-3 border rounded h-24 font-mono"></textarea>
                        <div class="flex space-x-2">
                            <button onclick="executeSQLQuery()" class="btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                                <i class="fas fa-play mr-2"></i>Ejecutar
                            </button>
                            <button onclick="clearSQLResult()" class="btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                                <i class="fas fa-eraser mr-2"></i>Limpiar
                            </button>
                            <select id="quickQueries" onchange="loadQuickQuery(this.value)" class="p-2 border rounded">
                                <option value="">Consultas r√°pidas...</option>
                                <option value="SHOW TABLES">SHOW TABLES</option>
                                <option value="SELECT * FROM clientes">Ver clientes</option>
                                <option value="SELECT * FROM tecnicos">Ver t√©cnicos</option>
                                <option value="SELECT * FROM instalaciones">Ver instalaciones</option>
                                <option value="DESCRIBE clientes">Estructura clientes</option>
                                <option value="DESCRIBE tecnicos">Estructura t√©cnicos</option>
                            </select>
                        </div>
                        <div id="sqlResult" class="table-container border rounded p-3 bg-gray-50"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitoring Section -->
        <div id="monitoringSection" class="section p-6 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- System Performance -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-tachometer-alt text-blue-500 mr-3"></i>Rendimiento del Sistema
                    </h3>
                    <div id="performanceMetrics" class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Uso de Memoria:</span>
                            <span id="memoryUsage" class="font-semibold">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Tiempo de Respuesta API:</span>
                            <span id="avgResponseTime" class="font-semibold">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Conexiones Activas:</span>
                            <span id="activeConnections" class="font-semibold">-</span>
                        </div>
                    </div>
                    <button onclick="refreshPerformanceMetrics()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mt-4 w-full">
                        <i class="fas fa-sync-alt mr-2"></i>Actualizar M√©tricas
                    </button>
                </div>

                <!-- Error Monitoring -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>Monitoreo de Errores
                    </h3>
                    <div id="errorLog" class="terminal p-3 h-40 overflow-y-auto">
                        <div class="text-green-400">[INFO] Sistema funcionando correctamente</div>
                    </div>
                    <div class="flex space-x-2 mt-4">
                        <button onclick="refreshErrorLog()" class="btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            <i class="fas fa-sync-alt mr-2"></i>Actualizar
                        </button>
                        <button onclick="clearErrorLog()" class="btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            <i class="fas fa-trash mr-2"></i>Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Section -->
        <div id="toolsSection" class="section p-6 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Database Backup -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-database text-blue-500 mr-3"></i>Respaldo de BD
                    </h3>
                    <div class="space-y-3">
                        <button onclick="createDatabaseBackup()" class="btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-download mr-2"></i>Crear Respaldo
                        </button>
                        <button onclick="restoreDatabaseBackup()" class="btn bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-upload mr-2"></i>Restaurar Respaldo
                        </button>
                        <div id="backupStatus" class="text-sm text-gray-600"></div>
                    </div>
                </div>

                <!-- Cache Management -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-memory text-green-500 mr-3"></i>Gesti√≥n de Cache
                    </h3>
                    <div class="space-y-3">
                        <button onclick="clearAllCache()" class="btn bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-trash mr-2"></i>Limpiar Cache
                        </button>
                        <button onclick="preloadCache()" class="btn bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-rocket mr-2"></i>Precargar Cache
                        </button>
                        <div id="cacheStatus" class="text-sm text-gray-600"></div>
                    </div>
                </div>

                <!-- System Maintenance -->
                <div class="card-hover bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold flex items-center mb-4">
                        <i class="fas fa-wrench text-yellow-500 mr-3"></i>Mantenimiento
                    </h3>
                    <div class="space-y-3">
                        <button onclick="optimizeDatabase()" class="btn bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-magic mr-2"></i>Optimizar BD
                        </button>
                        <button onclick="validateDataIntegrity()" class="btn bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-check-circle mr-2"></i>Validar Integridad
                        </button>
                        <button onclick="systemHealthCheck()" class="btn bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full">
                            <i class="fas fa-heartbeat mr-2"></i>Chequeo Completo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <div class="flex items-center">
                <i class="fas fa-spinner fa-spin text-blue-500 text-2xl mr-3"></i>
                <span class="text-lg">Procesando...</span>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ADMIN PANEL SYSTEM
        // ============================================
        class AdminPanel {
            constructor() {
                this.apiUrl = 'http://localhost:8085/api';
                this.serverProcess = null;
                this.refreshInterval = null;
                this.init();
            }

            async init() {
                console.log('üöÄ Iniciando Panel de Administraci√≥n...');
                await this.checkSystemStatus();
                await this.loadDatabaseStats();
                this.startAutoRefresh();
                
                // Cargar estructura de base de datos al inicio
                setTimeout(() => {
                    loadDatabaseStructure();
                }, 1000);
            }

            // ============================================
            // SERVER MANAGEMENT
            // ============================================
            async startPHPServer() {
                const port = document.getElementById('serverPort').value || 8085;
                const documentRoot = document.getElementById('documentRoot').value || '.';
                const routerFile = document.getElementById('routerFile').value || 'router.php';
                
                this.addLog(`üöÄ Iniciando servidor PHP en puerto ${port}...`, 'info');
                
                try {
                    // Simulate server start - En un entorno real, esto ser√≠a una llamada al backend
                    const command = `php -S localhost:${port} -t ${documentRoot} ${routerFile}`;
                    this.addLog(`üìù Comando: ${command}`, 'info');
                    
                    // Actualizar estado
                    document.getElementById('phpServerStatus').className = 'status-indicator status-loading';
                    
                    // Simular inicio exitoso
                    setTimeout(() => {
                        document.getElementById('phpServerStatus').className = 'status-indicator status-online';
                        this.addLog(`‚úÖ Servidor PHP iniciado correctamente en puerto ${port}`, 'success');
                        this.checkSystemStatus();
                    }, 2000);
                    
                } catch (error) {
                    this.addLog(`‚ùå Error iniciando servidor: ${error.message}`, 'error');
                    document.getElementById('phpServerStatus').className = 'status-indicator status-offline';
                }
            }

            async stopPHPServer() {
                this.addLog('üõë Deteniendo servidor PHP...', 'warning');
                
                try {
                    document.getElementById('phpServerStatus').className = 'status-indicator status-loading';
                    
                    setTimeout(() => {
                        document.getElementById('phpServerStatus').className = 'status-indicator status-offline';
                        this.addLog('‚úÖ Servidor PHP detenido', 'info');
                        this.checkSystemStatus();
                    }, 1000);
                    
                } catch (error) {
                    this.addLog(`‚ùå Error deteniendo servidor: ${error.message}`, 'error');
                }
            }

            async restartPHPServer() {
                this.addLog('üîÑ Reiniciando servidor PHP...', 'warning');
                await this.stopPHPServer();
                setTimeout(() => this.startPHPServer(), 2000);
            }

            // ============================================
            // SYSTEM STATUS
            // ============================================
            async checkSystemStatus() {
                try {
                    // Verificar servidor PHP
                    await this.checkPHPServerStatus();
                    
                    // Verificar API
                    const startTime = Date.now();
                    const response = await fetch(`${this.apiUrl}/health`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        document.getElementById('systemStatus').innerHTML = 
                            '<span class="status-indicator status-online"></span>Sistema Online';
                        document.getElementById('apiStatus').className = 'status-indicator status-online';
                        document.getElementById('apiLastResponse').textContent = new Date().toLocaleTimeString();
                        document.getElementById('apiResponseTime').textContent = `${responseTime}ms`;
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    document.getElementById('systemStatus').innerHTML = 
                        '<span class="status-indicator status-offline"></span>Sistema Offline';
                    document.getElementById('apiStatus').className = 'status-indicator status-offline';
                    document.getElementById('apiLastResponse').textContent = 'Error';
                    document.getElementById('apiResponseTime').textContent = '-';
                }
            }
            
            async checkPHPServerStatus() {
                try {
                    // Verificar si el servidor PHP est√° corriendo haciendo una petici√≥n b√°sica
                    const phpServerUrl = `http://localhost:${document.getElementById('phpPort').textContent}`;
                    
                    // Crear un timeout manual ya que fetch timeout no est√° disponible en todos los navegadores
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000);
                    
                    const response = await fetch(phpServerUrl, {
                        method: 'HEAD',
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Si la respuesta es exitosa, el servidor est√° funcionando
                    if (response.ok || response.status < 500) {
                        document.getElementById('phpServerStatus').className = 'status-indicator status-online';
                        return true;
                    } else {
                        throw new Error('Server not responding properly');
                    }
                } catch (error) {
                    // Si hay error (incluyendo timeout), el servidor est√° offline
                    document.getElementById('phpServerStatus').className = 'status-indicator status-offline';
                    return false;
                }
            }

            async checkAPIHealth() {
                this.addLog('üè• Verificando salud de la API...', 'info');
                
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${this.apiUrl}/health`);
                    const responseTime = Date.now() - startTime;
                    const data = await response.json();
                    
                    this.addLog(`‚úÖ API respondi√≥ en ${responseTime}ms`, 'success');
                    this.addLog(`üìä Datos: ${JSON.stringify(data)}`, 'info');
                    
                } catch (error) {
                    this.addLog(`‚ùå Error en API Health: ${error.message}`, 'error');
                }
            }

            // ============================================
            // DATABASE MANAGEMENT
            // ============================================
            async loadDatabaseStats() {
                try {
                    const [clientes, instalaciones, tecnicos] = await Promise.all([
                        fetch(`${this.apiUrl}/clientes`).then(r => r.json()),
                        fetch(`${this.apiUrl}/instalaciones`).then(r => r.json()),
                        fetch(`${this.apiUrl}/tecnicos`).then(r => r.json())
                    ]);
                    
                    document.getElementById('clientesCount').textContent = clientes.length || clientes.data?.length || 0;
                    document.getElementById('instalacionesCount').textContent = instalaciones.length || instalaciones.data?.length || 0;
                    document.getElementById('tecnicosCount').textContent = tecnicos.length || tecnicos.data?.length || 0;
                    document.getElementById('certificadosCount').textContent = '0'; // TODO: agregar endpoint
                    
                } catch (error) {
                    this.addLog(`‚ùå Error cargando estad√≠sticas: ${error.message}`, 'error');
                }
            }

            async queryTableData() {
                const table = document.getElementById('queryTable').value;
                if (!table) {
                    this.showMessage('Selecciona una tabla', 'warning');
                    return;
                }
                
                this.addLog(`üîç Consultando datos de tabla: ${table}`, 'info');
                
                try {
                    const response = await fetch(`http://localhost:8085/admin-simple.php?action=table_data&table=${table}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        this.displayTableData(result.data, table);
                        this.addLog(`‚úÖ Datos de ${table} cargados (${result.data.length || 0} registros)`, 'success');
                    } else {
                        throw new Error(result.message);
                    }
                    
                } catch (error) {
                    this.addLog(`‚ùå Error consultando ${table}: ${error.message}`, 'error');
                }
            }

            displayTableData(data, tableName) {
                const container = document.getElementById('tableData');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center">No hay datos en la tabla</p>';
                    return;
                }
                
                const keys = Object.keys(data[0]);
                const tableHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full table-auto">
                            <thead>
                                <tr class="bg-gray-100">
                                    ${keys.map(key => `<th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">${key}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${data.slice(0, 10).map(row => `
                                    <tr class="border-b">
                                        ${keys.map(key => `<td class="px-3 py-2 text-sm text-gray-900">${row[key] || '-'}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        ${data.length > 10 ? `<p class="text-xs text-gray-500 mt-2">Mostrando 10 de ${data.length} registros</p>` : ''}
                    </div>
                `;
                
                container.innerHTML = tableHTML;
            }

            async executeSQLQuery() {
                const query = document.getElementById('sqlQuery').value.trim();
                if (!query) {
                    this.showMessage('Ingresa una consulta SQL', 'warning');
                    return;
                }
                
                this.addLog(`üîç Ejecutando: ${query}`, 'info');
                
                // Simular ejecuci√≥n SQL (en producci√≥n esto ser√≠a una llamada al backend)
                try {
                    document.getElementById('sqlResult').innerHTML = 
                        '<div class="text-yellow-600">‚ö†Ô∏è Funcionalidad de SQL directo pendiente de implementar por seguridad</div>';
                    
                    this.addLog('‚ö†Ô∏è SQL directo deshabilitado por seguridad', 'warning');
                } catch (error) {
                    this.addLog(`‚ùå Error en consulta SQL: ${error.message}`, 'error');
                }
            }

            // ============================================
            // API MANAGEMENT
            // ============================================
            async loadAPIRoutes() {
                const routes = [
                    { method: 'GET', path: '/health', description: 'Verificar estado del servidor' },
                    { method: 'GET', path: '/clientes', description: 'Obtener todos los clientes' },
                    { method: 'POST', path: '/clientes', description: 'Crear nuevo cliente' },
                    { method: 'PUT', path: '/clientes/{id}', description: 'Actualizar cliente' },
                    { method: 'DELETE', path: '/clientes/{id}', description: 'Eliminar cliente' },
                    { method: 'GET', path: '/instalaciones', description: 'Obtener todas las instalaciones' },
                    { method: 'POST', path: '/instalaciones', description: 'Crear nueva instalaci√≥n' },
                    { method: 'GET', path: '/tecnicos', description: 'Obtener todos los t√©cnicos' },
                    { method: 'POST', path: '/tecnicos', description: 'Crear nuevo t√©cnico' },
                    { method: 'GET', path: '/empresa', description: 'Obtener datos de empresa' },
                    { method: 'GET', path: '/configuracion', description: 'Obtener configuraci√≥n' },
                    { method: 'GET', path: '/contadores/{tipo}', description: 'Obtener contador espec√≠fico' }
                ];
                
                const container = document.getElementById('apiRoutes');
                container.innerHTML = routes.map(route => {
                    const methodColor = {
                        'GET': 'bg-green-100 text-green-800',
                        'POST': 'bg-blue-100 text-blue-800',
                        'PUT': 'bg-yellow-100 text-yellow-800',
                        'DELETE': 'bg-red-100 text-red-800'
                    };
                    
                    return `
                        <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <span class="px-2 py-1 rounded text-xs font-medium ${methodColor[route.method]}">${route.method}</span>
                                <code class="text-sm text-gray-700">${route.path}</code>
                            </div>
                            <div class="text-xs text-gray-500">${route.description}</div>
                        </div>
                    `;
                }).join('');
                
                this.addLog(`‚úÖ ${routes.length} rutas API cargadas`, 'success');
            }

            async testAPIEndpoint() {
                const method = document.getElementById('apiMethod').value;
                const endpoint = document.getElementById('apiEndpoint').value;
                const dataStr = document.getElementById('apiData').value;
                
                if (!endpoint) {
                    this.showMessage('Ingresa un endpoint para probar', 'warning');
                    return;
                }
                
                this.addLog(`üß™ Probando ${method} ${endpoint}`, 'info');
                
                try {
                    const options = {
                        method: method,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (dataStr && (method === 'POST' || method === 'PUT')) {
                        options.body = dataStr;
                    }
                    
                    const startTime = Date.now();
                    const response = await fetch(`${this.apiUrl}${endpoint}`, options);
                    const responseTime = Date.now() - startTime;
                    const result = await response.json();
                    
                    const resultContainer = document.getElementById('apiTestResult');
                    resultContainer.classList.remove('hidden');
                    resultContainer.innerHTML = `
                        <div class="text-green-400">Status: ${response.status} ${response.statusText}</div>
                        <div class="text-blue-400">Tiempo: ${responseTime}ms</div>
                        <div class="text-white mt-2">Respuesta:</div>
                        <pre class="text-gray-300 mt-1">${JSON.stringify(result, null, 2)}</pre>
                    `;
                    
                    this.addLog(`‚úÖ ${method} ${endpoint} - ${response.status} (${responseTime}ms)`, 'success');
                    
                } catch (error) {
                    this.addLog(`‚ùå Error en prueba API: ${error.message}`, 'error');
                    
                    const resultContainer = document.getElementById('apiTestResult');
                    resultContainer.classList.remove('hidden');
                    resultContainer.innerHTML = `<div class="text-red-400">Error: ${error.message}</div>`;
                }
            }

            // ============================================
            // UTILITY METHODS
            // ============================================
            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show selected section
                document.getElementById(`${sectionName}Section`).classList.remove('hidden');
                
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(tab => {
                    tab.classList.remove('border-blue-500', 'text-blue-600');
                    tab.classList.add('border-transparent', 'text-gray-500');
                });
                
                document.getElementById(`${sectionName}Tab`).classList.add('border-blue-500', 'text-blue-600');
                document.getElementById(`${sectionName}Tab`).classList.remove('border-transparent', 'text-gray-500');
                
                // Load section-specific data
                switch (sectionName) {
                    case 'api':
                        this.loadAPIRoutes();
                        break;
                    case 'database':
                        loadDatabaseStructure(); // Funci√≥n global
                        break;
                    case 'monitoring':
                        refreshPerformanceMetrics(); // Funci√≥n global
                        break;
                }
            }

            addLog(message, type = 'info') {
                const logContainer = document.getElementById('serverLogs');
                const timestamp = new Date().toLocaleTimeString();
                const colors = {
                    'info': 'text-blue-400',
                    'success': 'text-green-400',
                    'warning': 'text-yellow-400',
                    'error': 'text-red-400'
                };
                
                const logEntry = document.createElement('div');
                logEntry.className = colors[type] || 'text-gray-400';
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            clearServerLogs() {
                document.getElementById('serverLogs').innerHTML = '';
                this.addLog('üìù Logs limpiados', 'info');
            }

            showMessage(message, type) {
                // Crear notificaci√≥n toast
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 
                    type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                } text-white`;
                toast.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation' : type === 'error' ? 'times' : 'info'} mr-2"></i>
                        ${message}
                    </div>
                `;
                
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            showLoading(show = true) {
                const overlay = document.getElementById('loadingOverlay');
                if (show) {
                    overlay.classList.remove('hidden');
                } else {
                    overlay.classList.add('hidden');
                }
            }

            startAutoRefresh() {
                // Refrescar estado cada 30 segundos
                this.refreshInterval = setInterval(() => {
                    this.checkSystemStatus();
                }, 30000);
            }

            stopAutoRefresh() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
            }
        }

        // ============================================
        // GLOBAL FUNCTIONS
        // ============================================
        let adminPanel;

        document.addEventListener('DOMContentLoaded', () => {
            adminPanel = new AdminPanel();
            adminPanel.init(); // Llamar init expl√≠citamente
        });

        // Server functions
        function startPHPServer() { 
            if (adminPanel) adminPanel.startPHPServer(); 
        }
        function stopPHPServer() { 
            if (adminPanel) adminPanel.stopPHPServer(); 
        }
        function restartPHPServer() { 
            if (adminPanel) adminPanel.restartPHPServer(); 
        }
        function checkAPIHealth() { 
            if (adminPanel) adminPanel.checkAPIHealth(); 
        }

        // Navigation
        function showSection(sectionName) { 
            if (adminPanel) adminPanel.showSection(sectionName); 
        }

        // Database functions
        function loadDatabaseStats() { 
            if (adminPanel) adminPanel.loadDatabaseStats(); 
        }
        function queryTableData() { 
            if (adminPanel) adminPanel.queryTableData(); 
        }
        function executeSQLQuery() { 
            if (adminPanel) adminPanel.executeSQLQuery(); 
        }
        function clearSQLResult() { 
            document.getElementById('sqlResult').innerHTML = ''; 
        }
        function loadQuickQuery(query) { 
            if (query) document.getElementById('sqlQuery').value = query; 
        }

        // API functions
        function loadAPIRoutes() { 
            if (adminPanel) adminPanel.loadAPIRoutes(); 
        }
        function testAPIEndpoint() { 
            if (adminPanel) adminPanel.testAPIEndpoint(); 
        }

        // Tools functions
        function clearServerLogs() { 
            if (adminPanel) adminPanel.clearServerLogs(); 
        }
        
        // Placeholder functions for advanced features
        async function loadDatabaseStructure() {
            if (!adminPanel) return;
            try {
                adminPanel.addLog('üèóÔ∏è Cargando estructura de base de datos...', 'info');
                
                const response = await fetch('http://localhost:8085/admin-simple.php?action=database_structure');
                const result = await response.json();
                
                if (result.success) {
                    const container = document.getElementById('database-structure');
                    if (container) {
                        container.innerHTML = renderDatabaseStructure(result.data);
                        adminPanel.addLog('‚úÖ Estructura de base de datos cargada', 'success');
                    }
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Error loading database structure:', error);
                adminPanel.addLog('‚ùå Error cargando estructura de base de datos', 'error');
                adminPanel.showMessage('Error cargando estructura de base de datos', 'error');
                
                // Fallback to simulated data
                loadMockDatabaseStructure();
            }
        }
        
        function loadMockDatabaseStructure() {
            const mockStructure = {
                'clientes': {
                    columns: [
                        {Field: 'id', Type: 'int', Null: 'NO', Key: 'PRI'},
                        {Field: 'nombre', Type: 'varchar(255)', Null: 'NO'},
                        {Field: 'telefono', Type: 'varchar(20)', Null: 'YES'},
                        {Field: 'email', Type: 'varchar(255)', Null: 'YES'},
                        {Field: 'direccion', Type: 'text', Null: 'YES'}
                    ],
                    row_count: 42,
                    size_mb: 0.15
                },
                'instalaciones': {
                    columns: [
                        {Field: 'id', Type: 'int', Null: 'NO', Key: 'PRI'},
                        {Field: 'cliente_id', Type: 'int', Null: 'NO'},
                        {Field: 'nombre', Type: 'varchar(255)', Null: 'NO'},
                        {Field: 'ubicacion', Type: 'varchar(255)', Null: 'NO'},
                        {Field: 'fecha_instalacion', Type: 'date', Null: 'YES'}
                    ],
                    row_count: 38,
                    size_mb: 0.12
                },
                'tecnicos': {
                    columns: [
                        {Field: 'id', Type: 'int', Null: 'NO', Key: 'PRI'},
                        {Field: 'nombre', Type: 'varchar(255)', Null: 'NO'},
                        {Field: 'email', Type: 'varchar(255)', Null: 'YES'},
                        {Field: 'telefono', Type: 'varchar(20)', Null: 'YES'},
                        {Field: 'especialidad', Type: 'varchar(100)', Null: 'YES'}
                    ],
                    row_count: 8,
                    size_mb: 0.05
                }
            };
            
            const container = document.getElementById('database-structure');
            if (container) {
                container.innerHTML = renderDatabaseStructure(mockStructure);
            }
        }
        
        function renderDatabaseStructure(structure) {
            // Poblar selectores de tablas
            populateTableSelectors(structure);
            
            let html = '<div class="space-y-3">';
            
            // Mostrar resumen de tablas
            html += `
                <div class="bg-gray-50 rounded-lg p-3 mb-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Resumen de Base de Datos</h4>
                    <div class="text-sm text-gray-600">
                        Total de tablas: <span class="font-medium">${Object.keys(structure).length}</span> ‚Ä¢
                        Total de registros: <span class="font-medium">${Object.values(structure).reduce((sum, table) => sum + table.row_count, 0)}</span>
                    </div>
                </div>
            `;
            
            for (const [tableName, tableInfo] of Object.entries(structure)) {
                html += `
                    <div class="border rounded-lg p-3 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-medium text-gray-800">${tableName}</h4>
                                <div class="text-xs text-gray-500">
                                    ${tableInfo.columns.length} columnas ‚Ä¢ ${tableInfo.row_count} registros ‚Ä¢ ${tableInfo.size_mb} MB
                                </div>
                            </div>
                            <div class="flex space-x-1">
                                <button onclick="queryTable('${tableName}')" 
                                        class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600" 
                                        title="Consultar datos">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="showTableDetails('${tableName}')" 
                                        class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600"
                                        title="Ver estructura">
                                    <i class="fas fa-table"></i>
                                </button>
                            </div>
                        </div>
                    </div>`;
            }
            
            html += '</div>';
            return html;
        }
        
        function loadTableStructure(table) {
            if (table && adminPanel) {
                adminPanel.addLog(`üîç Cargando estructura de tabla: ${table}`, 'info');
                
                // Obtener la estructura desde los datos ya cargados
                fetch('http://localhost:8085/admin-simple.php?action=database_structure')
                    .then(response => response.json())
                    .then(result => {
                        if (result.success && result.data[table]) {
                            const tableInfo = result.data[table];
                            const container = document.getElementById('tableStructure');
                            
                            if (container) {
                                let html = `
                                    <div class="mb-3">
                                        <h4 class="font-semibold text-gray-800 mb-2">${table}</h4>
                                        <div class="text-sm text-gray-600 mb-3">
                                            ${tableInfo.columns.length} columnas ‚Ä¢ ${tableInfo.row_count} registros ‚Ä¢ ${tableInfo.size_mb} MB
                                        </div>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full text-xs">
                                            <thead class="bg-gray-100">
                                                <tr>
                                                    <th class="px-2 py-1 text-left">Campo</th>
                                                    <th class="px-2 py-1 text-left">Tipo</th>
                                                    <th class="px-2 py-1 text-left">Nulo</th>
                                                    <th class="px-2 py-1 text-left">Key</th>
                                                    <th class="px-2 py-1 text-left">Extra</th>
                                                </tr>
                                            </thead>
                                            <tbody>`;
                                
                                tableInfo.columns.forEach(column => {
                                    html += `
                                        <tr class="border-t">
                                            <td class="px-2 py-1 font-medium">${column.Field}</td>
                                            <td class="px-2 py-1 text-gray-600">${column.Type}</td>
                                            <td class="px-2 py-1">${column.Null}</td>
                                            <td class="px-2 py-1 text-blue-600">${column.Key || '-'}</td>
                                            <td class="px-2 py-1 text-gray-500">${column.Extra || '-'}</td>
                                        </tr>`;
                                });
                                
                                html += `
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="mt-3 flex space-x-2">
                                        <button onclick="queryTable('${table}')" 
                                                class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">
                                            <i class="fas fa-eye mr-1"></i>Ver datos
                                        </button>
                                    </div>`;
                                
                                container.innerHTML = html;
                                adminPanel.addLog(`‚úÖ Estructura de ${table} cargada`, 'success');
                            }
                        } else {
                            throw new Error('Tabla no encontrada');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading table structure:', error);
                        adminPanel.addLog(`‚ùå Error cargando estructura de ${table}`, 'error');
                    });
            }
        }
        
        function populateTableSelectors(structure) {
            const tableNames = Object.keys(structure);
            
            // Poblar selector de estructura de tabla
            const tableSelector = document.getElementById('tableSelector');
            if (tableSelector) {
                tableSelector.innerHTML = '<option value="">Seleccionar tabla...</option>';
                tableNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    tableSelector.appendChild(option);
                });
            }
            
            // Poblar selector de consulta de datos
            const queryTable = document.getElementById('queryTable');
            if (queryTable) {
                queryTable.innerHTML = '<option value="">Tabla...</option>';
                tableNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    queryTable.appendChild(option);
                });
            }
        }
        
        function queryTable(tableName) {
            // Seleccionar la tabla en el selector y ejecutar la consulta
            const queryTableSelect = document.getElementById('queryTable');
            if (queryTableSelect && adminPanel) {
                queryTableSelect.value = tableName;
                adminPanel.queryTableData();
            }
        }
        
        function analyzeTable(tableName) {
            if (adminPanel) {
                adminPanel.addLog(`üîç Analizando tabla: ${tableName}`, 'info');
                adminPanel.showMessage('Funcionalidad de an√°lisis en desarrollo', 'info');
            }
        }
        
        function showTableDetails(tableName) {
            // Mostrar la estructura detallada de la tabla en el tableStructure
            const tableSelector = document.getElementById('tableSelector');
            if (tableSelector && adminPanel) {
                tableSelector.value = tableName;
                loadTableStructure(tableName);
                adminPanel.addLog(`üìã Mostrando detalles de tabla: ${tableName}`, 'info');
            }
        }
        
        function updateRouterConfig() {
            if (adminPanel) {
                adminPanel.addLog('‚öôÔ∏è Actualizando configuraci√≥n del router...', 'info');
                adminPanel.showMessage('Configuraci√≥n guardada', 'success');
            }
        }
        
        function viewRouterFile() {
            if (adminPanel) {
                adminPanel.addLog('üëÄ Abriendo archivo router.php...', 'info');
            }
            window.open('router.php', '_blank');
        }
        
        async function refreshPerformanceMetrics() {
            if (!adminPanel) return;
            try {
                adminPanel.addLog('üìä Actualizando m√©tricas de rendimiento...', 'info');
                
                const response = await fetch('http://localhost:8085/admin-simple.php?action=performance');
                const result = await response.json();
                
                if (result.success) {
                    const metrics = result.data;
                    
                    // Actualizar memoria
                    const memoryMB = (metrics.memory.current / 1024 / 1024).toFixed(1);
                    document.getElementById('memoryUsage').textContent = `${memoryMB} MB`;
                    
                    // Actualizar CPU (load average)
                    const cpuElement = document.getElementById('cpuUsage');
                    if (cpuElement && metrics.load_average) {
                        cpuElement.textContent = `${metrics.load_average[0]}%`;
                    }
                    
                    // Actualizar disco
                    const diskElement = document.getElementById('diskUsage');
                    if (diskElement && metrics.disk_usage) {
                        diskElement.textContent = `${metrics.disk_usage.percentage}%`;
                    }
                    
                    adminPanel.addLog('‚úÖ M√©tricas actualizadas', 'success');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Error updating metrics:', error);
                adminPanel.addLog('‚ùå Error actualizando m√©tricas', 'error');
                
                // Fallback values
                document.getElementById('memoryUsage').textContent = '45.2 MB';
                const cpuElement = document.getElementById('cpuUsage');
                if (cpuElement) cpuElement.textContent = '12%';
                const diskElement = document.getElementById('diskUsage');
                if (diskElement) diskElement.textContent = '68%';
            }
        }
        
        async function loadDatabaseStats() {
            if (!adminPanel) return;
            try {
                adminPanel.addLog('üìà Cargando estad√≠sticas de base de datos...', 'info');
                
                const response = await fetch('http://localhost:8085/admin-simple.php?action=database_stats');
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    const container = document.getElementById('database-stats');
                    
                    if (container) {
                        let html = `
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                <div class="text-center p-3 bg-blue-50 rounded">
                                    <div class="text-xl font-bold text-blue-600">${stats.total_size_mb}</div>
                                    <div class="text-sm text-gray-600">MB Total</div>
                                </div>
                                <div class="text-center p-3 bg-green-50 rounded">
                                    <div class="text-xl font-bold text-green-600">${Object.keys(stats.table_counts).length}</div>
                                    <div class="text-sm text-gray-600">Tablas</div>
                                </div>
                                <div class="text-center p-3 bg-purple-50 rounded">
                                    <div class="text-xl font-bold text-purple-600">${Object.values(stats.table_counts).reduce((a, b) => a + b, 0)}</div>
                                    <div class="text-sm text-gray-600">Registros</div>
                                </div>
                                <div class="text-center p-3 bg-yellow-50 rounded">
                                    <div class="text-xl font-bold text-yellow-600">${stats.database_name}</div>
                                    <div class="text-sm text-gray-600">Base de datos</div>
                                </div>
                            </div>
                            <div class="space-y-2">`;
                        
                        for (const [table, count] of Object.entries(stats.table_counts)) {
                            html += `
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span class="font-medium">${table}</span>
                                    <span class="text-blue-600">${count} registros</span>
                                </div>`;
                        }
                        
                        html += `</div>
                            <div class="text-xs text-gray-500 mt-4">
                                √öltima actualizaci√≥n: ${stats.last_updated}
                            </div>`;
                        
                        container.innerHTML = html;
                    }
                    
                    adminPanel.addLog('‚úÖ Estad√≠sticas de base de datos cargadas', 'success');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Error loading database stats:', error);
                adminPanel.addLog('‚ùå Error cargando estad√≠sticas', 'error');
            }
        }
        
        async function runHealthCheck() {
            if (!adminPanel) return;
            try {
                adminPanel.addLog('üè• Ejecutando chequeo de salud del sistema...', 'info');
                
                const response = await fetch('http://localhost:8085/admin-simple.php?action=health');
                const result = await response.json();
                
                if (result.success) {
                    const health = result.data;
                    const container = document.getElementById('health-status');
                    
                    if (container) {
                        let html = `
                            <div class="p-4 rounded-lg ${health.status === 'healthy' ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} border">
                                <div class="flex items-center mb-3">
                                    <i class="fas fa-${health.status === 'healthy' ? 'check-circle text-green-500' : 'exclamation-triangle text-red-500'} mr-2"></i>
                                    <span class="font-semibold">Estado: ${health.status === 'healthy' ? 'Saludable' : 'Problemas detectados'}</span>
                                </div>
                                <div class="space-y-2">`;
                        
                        for (const [check, status] of Object.entries(health.checks)) {
                            const isOk = status === 'OK';
                            html += `
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">${check.replace(/_/g, ' ')}</span>
                                    <span class="text-xs px-2 py-1 rounded ${isOk ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${status}
                                    </span>
                                </div>`;
                        }
                        
                        html += `</div>
                            <div class="text-xs text-gray-500 mt-3">
                                Chequeo realizado: ${health.timestamp}
                            </div>
                        </div>`;
                        
                        container.innerHTML = html;
                    }
                    
                    adminPanel.addLog('‚úÖ Chequeo de salud completado', 'success');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Error running health check:', error);
                adminPanel.addLog('‚ùå Error en chequeo de salud', 'error');
                adminPanel.showMessage('Error ejecutando chequeo de salud', 'error');
            }
        }
        
        async function validateDataIntegrity() {
            if (!adminPanel) return;
            
            try {
                adminPanel.addLog('üîç Validando integridad de datos...', 'info');
                
                const response = await fetch('http://localhost:8085/admin-simple.php?action=validate', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    const validation = result.data;
                    const container = document.getElementById('integrity-results');
                    
                    if (container) {
                        let html = `
                            <div class="p-4 rounded-lg ${validation.status === 'healthy' ? 'bg-green-50' : 'bg-yellow-50'} border">
                                <h4 class="font-semibold mb-3">
                                    <i class="fas fa-shield-alt mr-2"></i>
                                    Validaci√≥n de Integridad
                                </h4>`;
                        
                        if (validation.issues.length === 0) {
                            html += '<p class="text-green-700">‚úÖ No se encontraron problemas de integridad</p>';
                        } else {
                            html += '<div class="space-y-2">';
                            validation.issues.forEach(issue => {
                                const icon = issue.type === 'error' ? 'fas fa-exclamation-circle text-red-500' : 'fas fa-exclamation-triangle text-yellow-500';
                                html += `
                                    <div class="flex items-start">
                                        <i class="${icon} mt-1 mr-2"></i>
                                        <span class="text-sm">${issue.message}</span>
                                    </div>`;
                            });
                            html += '</div>';
                        }
                        
                        html += `
                            <div class="text-xs text-gray-500 mt-3">
                                Validaci√≥n realizada: ${validation.checked_at}
                            </div>
                        </div>`;
                        
                        container.innerHTML = html;
                    }
                    
                    adminPanel.addLog('‚úÖ Validaci√≥n de integridad completada', 'success');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Error validating data integrity:', error);
                adminPanel.addLog('‚ùå Error validando integridad', 'error');
                adminPanel.showMessage('Error en validaci√≥n de integridad', 'error');
            }
        }
        
        function refreshErrorLog() {
            adminPanel.addLog('üîç Actualizando log de errores...', 'info');
        }
        
        function clearErrorLog() {
            document.getElementById('errorLog').innerHTML = '<div class="text-green-400">[INFO] Log limpiado</div>';
        }
        
        // Tool functions
        function createDatabaseBackup() {
            if (!adminPanel) return;
            adminPanel.addLog('üíæ Creando respaldo de base de datos...', 'info');
            adminPanel.showMessage('Respaldo creado exitosamente', 'success');
        }
        
        function restoreDatabaseBackup() {
            if (!adminPanel) return;
            adminPanel.addLog('üì• Restaurando respaldo de base de datos...', 'warning');
            adminPanel.showMessage('Funcionalidad en desarrollo', 'info');
        }
        
        function clearAllCache() {
            if (!adminPanel) return;
            adminPanel.addLog('üßπ Limpiando todo el cache...', 'info');
            adminPanel.showMessage('Cache limpiado', 'success');
        }
        
        function preloadCache() {
            if (!adminPanel) return;
            adminPanel.addLog('üöÄ Precargando cache del sistema...', 'info');
            adminPanel.showMessage('Cache precargado', 'success');
        }
        
        function optimizeDatabase() {
            if (!adminPanel) return;
            adminPanel.addLog('‚ö° Optimizando base de datos...', 'info');
            adminPanel.showMessage('Base de datos optimizada', 'success');
        }
        
        function validateDataIntegrity() {
            if (!adminPanel) return;
            adminPanel.addLog('üîç Validando integridad de datos...', 'info');
            adminPanel.showMessage('Integridad validada - Todo OK', 'success');
        }
        
        function systemHealthCheck() {
            if (!adminPanel) return;
            adminPanel.addLog('üè• Ejecutando chequeo completo del sistema...', 'info');
            adminPanel.checkAPIHealth();
            adminPanel.loadDatabaseStats();
            adminPanel.showMessage('Chequeo completo realizado', 'success');
        }
    </script>
</body>
</html>
